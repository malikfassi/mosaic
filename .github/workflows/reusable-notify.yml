---
name: Notify Status

on:
  workflow_call:
    inputs:
      execution_plan:
        required: true
        type: string
      frontend_lint_result:
        required: true
        type: string
      frontend_test_result:
        required: true
        type: string
      frontend_build_result:
        required: true
        type: string
      mosaic_tile_lint_result:
        required: true
        type: string
      mosaic_tile_test_result:
        required: true
        type: string
      mosaic_tile_schema_result:
        required: true
        type: string
      mosaic_tile_format_result:
        required: true
        type: string
      mosaic_tile_deploy_result:
        required: true
        type: string
      mosaic_tile_e2e_result:
        required: true
        type: string
      mosaic_vending_format_result:
        required: true
        type: string
      mosaic_vending_schema_result:
        required: true
        type: string
      mosaic_vending_lint_result:
        required: true
        type: string
      mosaic_vending_test_result:
        required: true
        type: string
      mosaic_vending_deploy_result:
        required: true
        type: string
      mosaic_vending_e2e_result:
        required: true
        type: string
      full_e2e_result:
        required: true
        type: string
      gist_id:
        required: true
        type: string
    secrets:
      GIST_SECRET:
        required: true
      DISCORD_WEBHOOK:
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: .github/workflow-scripts/package.json

      - name: Install dependencies
        working-directory: .github/workflow-scripts
        run: npm ci

      - name: Generate notification
        id: notify
        working-directory: .github/workflow-scripts
        env:
          EXECUTION_PLAN: ${{ inputs.execution_plan }}
          FRONTEND_LINT_RESULT: ${{ inputs.frontend_lint_result }}  
          FRONTEND_TEST_RESULT: ${{ inputs.frontend_test_result }}
          FRONTEND_BUILD_RESULT: ${{ inputs.frontend_build_result }}
          MOSAIC_TILE_LINT_RESULT: ${{ inputs.mosaic_tile_lint_result }}
          MOSAIC_TILE_TEST_RESULT: ${{ inputs.mosaic_tile_test_result }}
          MOSAIC_TILE_SCHEMA_RESULT: ${{ inputs.mosaic_tile_schema_result }}
          MOSAIC_TILE_FORMAT_RESULT: ${{ inputs.mosaic_tile_format_result }}
          MOSAIC_VENDING_LINT_RESULT: ${{ inputs.mosaic_vending_lint_result }}
          MOSAIC_VENDING_TEST_RESULT: ${{ inputs.mosaic_vending_test_result }}
          MOSAIC_VENDING_SCHEMA_RESULT: ${{ inputs.mosaic_vending_schema_result }}
          MOSAIC_VENDING_FORMAT_RESULT: ${{ inputs.mosaic_vending_format_result }}
          MOSAIC_TILE_DEPLOY_RESULT: ${{ inputs.mosaic_tile_deploy_result }}
          MOSAIC_VENDING_DEPLOY_RESULT: ${{ inputs.mosaic_vending_deploy_result }}
          MOSAIC_TILE_E2E_RESULT: ${{ inputs.mosaic_tile_e2e_result }}
          MOSAIC_VENDING_E2E_RESULT: ${{ inputs.mosaic_vending_e2e_result }}
          FULL_E2E_RESULT: ${{ inputs.full_e2e_result }}
          GIST_SECRET: ${{ secrets.GIST_SECRET }}
          GIST_ID: ${{ inputs.gist_id }}
        run: |
          npm run notify

      - name: Send Discord notification
        uses: tsickert/discord-webhook@v5.3.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          filename: discord_message.txt
